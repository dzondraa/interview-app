<!doctype html>
<html>
  <head></head>
  <body class="default-theme des-mat" style="background: rgb(255, 255, 255);">
    <script>
    function AjaxThingy(){
    	this.settings = {
    		headers:{
    			'Content-Type': 'application/json'
    		}
    	}
    	function param(object) {
    	    var encodedString = '';
    	    for (var prop in object) {
    	        if (object.hasOwnProperty(prop)) {
    	            if (encodedString.length > 0) {
    	                encodedString += '&';
    	            }
    	            encodedString += prop + '=' + encodeURIComponent(object[prop]);
    	        }
    	    }
    	    return encodedString;
    	}
    	this.request = function(method, uri, query, body, cb){
    		var inst = this
    		uri = inst.settings.baseURL ? inst.settings.baseURL + uri : uri
    		var xhr = new XMLHttpRequest();
    		xhr.withCredentials = false;
    		if(query){
    			uri += (uri.indexOf('?') == -1 ? '?' : '&')+param(query)
    		}
    		var ct = inst.settings.headers['Content-Type'] ? inst.settings.headers['Content-Type'] : null
    		xhr.open(method, uri);
    		if(this.settings.headers){
    			for(var i in this.settings.headers){
    				xhr.setRequestHeader(i, this.settings.headers[i]);
    			}
    		}
    		xhr.onload = function() {
    			var err = null
    		    if (xhr.status < 200 || xhr.status >= 300) {
    		    	err = new Error('Request failed.  Returned status of ' + xhr.status)
    		    }
    		    if(ct && ct == 'application/json'){
    		    	var resp = JSON.parse(xhr.responseText)
    		    	if(err && resp.message){err = new Error(resp.message)}
    	    		cb.call(inst, err, resp, xhr)
    	    	}else{
    	    		cb.call(inst, err, xhr.responseText, xhr)
    	    	}
    		};
    		if(body){
    			if(ct && ct == 'application/x-www-form-urlencoded'){
    	    		xhr.send(param(body));
    	    	}else if(ct && ct == 'application/json'){
    	    		xhr.send(JSON.stringify(body));
    	    	}else{
    	    		xhr.send(body);
    	    	}
    		}else{
    			xhr.send();
    		}
    	}
    }
	window.Ajax = new AjaxThingy()
	
	let path = window.location.pathname.split('/')
	path.pop()
	path = path.join('/')

    function createCookie(name,value,days) {
    	if (days) {
    		var date = new Date();
    		date.setTime(date.getTime()+(days*24*60*60*1000));
    		var expires = "; expires="+date.toGMTString();
    	}
    	else var expires = "";
    	document.cookie = name+"="+value+expires+"; path=/";
    }

    function eraseCookie(name) {
    	createCookie(name,"",-1);
	}

    function doLogin(){
      var u = document.getElementById('u').value;
      var p = document.getElementById('p').value;
      Ajax.request('POST', path+'/login', null, {"login":u, "password":p}, function(err, resp){
        console.log(err, resp);
        if(resp && resp.records && resp.records[0] && resp.records[0].token){
          createCookie('token', resp.records[0].token, 365);
          window.location.href = path+'/';
        }else{
          var m = "Cannot login";
          if(err && err.message){ m = err.message  }else if(resp && resp.message){ m = resp.message  }
          document.getElementById('m').innerHTML = m;
        }
      })
    }


    </script>
    <input type="text" id="u"><br>
    <input type="password" id="p"><br>
    <button onclick="doLogin()">Login</button><br>
    <span id="m"></span>
  </body>
</html>
